
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <link rel="shortcut icon" type="image/png" href="images/map_favicon.png"/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <title></title>
  </head>
  <body>
    <div class="container"><!-- start of the main container-->
        <div class="row justify-content-center"><!-- headline and intro -->
            <div class="col-lg-10 ">
                <p><a href="..">&#8592; back to homepage</a></p>
                <section id="getting-coordinates-from-addresses-with-google-geocoding" class="cell markdown">
<h2>Getting coordinates from addresses with Google Geocoding</h2>
</section>
<div class="cell markdown">
<p>If you are looking through a dataset and find a lovely list of addresses, we might want to map them to create some beautiful and informative visualizations. But without coordinates, we are a bit stuffed. That is where <a href="https://developers.google.com/maps/documentation/geocoding/overview">Google's Geocoding API</a> comes in.</p>
<p>This service will ping you coordinates when you feed it addresses. First, you will need to create an account <a href="https://developers.google.com/maps/documentation/geocoding/overview">here</a> and then create an API key <a href="https://developers.google.com/maps/documentation/geocoding/get-api-key">here</a>.</p>
<p>PLEASE NOTE: this service is free up to a point, but with heavy use you will be charged. For that reason, you should never publish public code that includes your API key unless you want to foot the bill for random strangers on the internet. For advice on hiding your API key in code, check out <a href="https://www.youtube.com/watch?v=IolxqkL7cD8">this YouTube tutorial</a>.</p>
</div>
<div class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import modules</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_columns&#39;</span>, <span class="va">None</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the list of addresses - in your code, you will</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#probably be importing a csv here instead.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>addresses <span class="op">=</span> [</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Empire State Building&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Columbia University Morningside&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Museum of Ice Cream New York City&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Wall Street Station New York&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;One Manhattan Square&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>addresses</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<pre><code>[&#39;Empire State Building&#39;,
 &#39;Columbia University Morningside&#39;,
 &#39;Museum of Ice Cream New York City&#39;,
 &#39;Wall Street Station New York&#39;,
 &#39;One Manhattan Square&#39;]</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set API key - YOU WILL NEED TO FILL THIS IN - and set URL</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>api_key <span class="op">=</span> <span class="st">&#39;[ENTER_API_KEY_HERE]&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&#39;https://maps.googleapis.com/maps/api/geocode/json&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create list of addresses</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>address_list <span class="op">=</span> []</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> address <span class="kw">in</span> addresses:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Set keys</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    keys <span class="op">=</span> {<span class="st">&#39;address&#39;</span>: address, <span class="st">&#39;key&#39;</span>: api_key}</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Ping the google geocoding api</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(url,params<span class="op">=</span>keys)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    result_dic <span class="op">=</span> r.json()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define full address</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    full_address <span class="op">=</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;formatted_address&#39;</span>]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define street number</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    street_number <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;address_components&#39;</span>]:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i[<span class="st">&#39;types&#39;</span>][<span class="dv">0</span>] <span class="op">==</span> <span class="st">&quot;street_number&quot;</span>:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            street_number <span class="op">=</span> i[<span class="st">&#39;long_name&#39;</span>]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define street name</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    street_name <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;address_components&#39;</span>]:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i[<span class="st">&#39;types&#39;</span>][<span class="dv">0</span>] <span class="op">==</span> <span class="st">&quot;route&quot;</span>:</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            street_name <span class="op">=</span> i[<span class="st">&#39;long_name&#39;</span>]</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define neighborhood</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    neighborhood <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;address_components&#39;</span>]:</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i[<span class="st">&#39;types&#39;</span>][<span class="dv">0</span>] <span class="op">==</span> <span class="st">&quot;neighborhood&quot;</span>:</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            neighborhood <span class="op">=</span> i[<span class="st">&#39;long_name&#39;</span>]</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define county</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    county <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;address_components&#39;</span>]:</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> i[<span class="st">&#39;types&#39;</span>]:</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">==</span> <span class="st">&quot;sublocality_level_1&quot;</span>:</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                county <span class="op">=</span> i[<span class="st">&#39;long_name&#39;</span>]</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define zip code</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    _zip <span class="op">=</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;address_components&#39;</span>]:</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i[<span class="st">&#39;types&#39;</span>][<span class="dv">0</span>] <span class="op">==</span> <span class="st">&quot;postal_code&quot;</span>:</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            _zip <span class="op">=</span> i[<span class="st">&#39;long_name&#39;</span>]</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define coordinates</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;location&#39;</span>][<span class="st">&#39;lat&#39;</span>]</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    lng <span class="op">=</span> result_dic[<span class="st">&#39;results&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;location&#39;</span>][<span class="st">&#39;lng&#39;</span>]</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Put everything in a dictionary</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    address_dict <span class="op">=</span> {</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;original_search&#39;</span>: address,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;full_address&#39;</span>: full_address,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;street_number&#39;</span>: street_number,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;street_name&#39;</span>: street_name,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;neighborhood&#39;</span>: neighborhood,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;county&#39;</span>: county,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;zip&#39;</span>: _zip,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;latitude&#39;</span>: lat,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;longitude&#39;</span>: lng</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Add this dictionary to the list of address dictionaries</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    address_list.append(address_dict)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>address_list</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<pre><code>[{&#39;original_search&#39;: &#39;Empire State Building&#39;,
  &#39;full_address&#39;: &#39;20 W 34th St, New York, NY 10001, USA&#39;,
  &#39;street_number&#39;: &#39;20&#39;,
  &#39;street_name&#39;: &#39;West 34th Street&#39;,
  &#39;neighborhood&#39;: &#39;N/A&#39;,
  &#39;county&#39;: &#39;Manhattan&#39;,
  &#39;zip&#39;: &#39;10001&#39;,
  &#39;latitude&#39;: 40.7484405,
  &#39;longitude&#39;: -73.98566439999999},
 {&#39;original_search&#39;: &#39;Columbia University Morningside&#39;,
  &#39;full_address&#39;: &#39;1150 Amsterdam Ave, New York, NY 10027, USA&#39;,
  &#39;street_number&#39;: &#39;1150&#39;,
  &#39;street_name&#39;: &#39;Amsterdam Avenue&#39;,
  &#39;neighborhood&#39;: &#39;N/A&#39;,
  &#39;county&#39;: &#39;Manhattan&#39;,
  &#39;zip&#39;: &#39;10027&#39;,
  &#39;latitude&#39;: 40.80741949999999,
  &#39;longitude&#39;: -73.9609062},
 {&#39;original_search&#39;: &#39;Museum of Ice Cream New York City&#39;,
  &#39;full_address&#39;: &#39;558 Broadway, New York, NY 10012, USA&#39;,
  &#39;street_number&#39;: &#39;558&#39;,
  &#39;street_name&#39;: &#39;Broadway&#39;,
  &#39;neighborhood&#39;: &#39;N/A&#39;,
  &#39;county&#39;: &#39;Manhattan&#39;,
  &#39;zip&#39;: &#39;10012&#39;,
  &#39;latitude&#39;: 40.7238545,
  &#39;longitude&#39;: -73.99791669999999},
 {&#39;original_search&#39;: &#39;Wall Street Station New York&#39;,
  &#39;full_address&#39;: &#39;Wall Street Station, New York, NY 10038, USA&#39;,
  &#39;street_number&#39;: &#39;N/A&#39;,
  &#39;street_name&#39;: &#39;N/A&#39;,
  &#39;neighborhood&#39;: &#39;N/A&#39;,
  &#39;county&#39;: &#39;Manhattan&#39;,
  &#39;zip&#39;: &#39;10038&#39;,
  &#39;latitude&#39;: 40.7063965,
  &#39;longitude&#39;: -74.0094441},
 {&#39;original_search&#39;: &#39;One Manhattan Square&#39;,
  &#39;full_address&#39;: &#39;225 Cherry St, New York, NY 10002, USA&#39;,
  &#39;street_number&#39;: &#39;225&#39;,
  &#39;street_name&#39;: &#39;Cherry Street&#39;,
  &#39;neighborhood&#39;: &#39;N/A&#39;,
  &#39;county&#39;: &#39;Manhattan&#39;,
  &#39;zip&#39;: &#39;10002&#39;,
  &#39;latitude&#39;: 40.71056979999999,
  &#39;longitude&#39;: -73.9913031}]</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Put everything in a lovely dataframe</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(address_list)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="output execute_result" data-execution_count="9">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original_search</th>
      <th>full_address</th>
      <th>street_number</th>
      <th>street_name</th>
      <th>neighborhood</th>
      <th>county</th>
      <th>zip</th>
      <th>latitude</th>
      <th>longitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Empire State Building</td>
      <td>20 W 34th St, New York, NY 10001, USA</td>
      <td>20</td>
      <td>West 34th Street</td>
      <td>N/A</td>
      <td>Manhattan</td>
      <td>10001</td>
      <td>40.748441</td>
      <td>-73.985664</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Columbia University Morningside</td>
      <td>1150 Amsterdam Ave, New York, NY 10027, USA</td>
      <td>1150</td>
      <td>Amsterdam Avenue</td>
      <td>N/A</td>
      <td>Manhattan</td>
      <td>10027</td>
      <td>40.807419</td>
      <td>-73.960906</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Museum of Ice Cream New York City</td>
      <td>558 Broadway, New York, NY 10012, USA</td>
      <td>558</td>
      <td>Broadway</td>
      <td>N/A</td>
      <td>Manhattan</td>
      <td>10012</td>
      <td>40.723855</td>
      <td>-73.997917</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Wall Street Station New York</td>
      <td>Wall Street Station, New York, NY 10038, USA</td>
      <td>N/A</td>
      <td>N/A</td>
      <td>N/A</td>
      <td>Manhattan</td>
      <td>10038</td>
      <td>40.706396</td>
      <td>-74.009444</td>
    </tr>
    <tr>
      <th>4</th>
      <td>One Manhattan Square</td>
      <td>225 Cherry St, New York, NY 10002, USA</td>
      <td>225</td>
      <td>Cherry Street</td>
      <td>N/A</td>
      <td>Manhattan</td>
      <td>10002</td>
      <td>40.710570</td>
      <td>-73.991303</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell markdown">
<p>This method is not 100% perfect and won't always return <em>all</em> the information you want, but it will almost always give you the lats and longs you are after. Please drop me a message at <a href="https://willjarrettdata.com/contact/">willjarrettdata.com</a> if you spot any problems.</p>
</div>

            </div>
        </div>
    </div>
  </body>
</html>